<!doctype html>
<html lang="en">
<head>
    <title>Info Cube viz</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <!--<link rel=stylesheet href="css/base.css"/>-->
</head>
<body>

<script src="node_modules/three/three.js"></script>
<script src="node_modules/tween.js"></script>
<script src="js/Detector.js"></script>
<!--<script src="js/Stats.js"></script>-->
<!--<script src="js/OrbitControls.js"></script>-->
<script src="js/THREEx.KeyboardState.js"></script>
<script src="js/THREEx.FullScreen.js"></script>
<script src="js/THREEx.WindowResize.js"></script>
<script src="js/OrbitControls.js"></script>

<!-- jQuery code to display an information button and box when clicked. -->
<script src="node_modules/jquery/dist/jquery.js"></script>
<script src="node_modules/jquery-ui/jquery-ui.js"></script>
<link rel=stylesheet href="node_modules/jquery-ui/themes/base/jquery-ui.css"/>
<!-- ------------------------------------------------------------ -->

<div id="ThreeJS" style="z-index: 1; position: absolute; left:0px; top:0px"></div>
<script>

    // MAIN

    // standard global variables
    var container, scene, camera, renderer, controls, stats, light;
    var keyboard = new THREEx.KeyboardState();
    var clock = new THREE.Clock();
    // custom global variables
    var cube;

    init();
    animate();

    function init() {

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
        camera.position.z = 1000;

        scene = new THREE.Scene();

        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize( window.innerWidth, window.innerHeight );

        controls = new THREE.OrbitControls( camera, renderer.domElement );

        THREEx.WindowResize(renderer, camera);
        THREEx.FullScreen.bindKey({ charCode : 'm'.charCodeAt(0) });


        mesh = new Box({size: 150});
        mesh2 = new Box({size: 100, color: 0xff0000});

        mesh.geometry.computeBoundingBox();
        mesh2.geometry.computeBoundingBox();

        for(var i = 0; i < 5; ++i )
            createChild(mesh);
        mesh3 = new Box({size: 20});
//
        mesh.add(mesh2);
        mesh2.add(mesh3);

        scene.add( mesh );

//        mesh.position.set(10,10,20);
//
//        mesh2.position.set(20,20,20);

//        scene.add(mesh4);
        var ambientLight = new THREE.AmbientLight(0x101010, 5.0);
        scene.add(ambientLight);

        scene.add(Floor());
        scene.add(SkyBox());
        scene.fog = new THREE.FogExp2( 0xffffff, 0.00025 );


        light = new THREE.PointLight(0xffffff);
        light.position = camera.position;
        scene.add(light);

        document.body.appendChild( renderer.domElement );

    }

    function Box(options){
        var options = options || {};

        var color = options.color || 0xff0000;
        var opacity = options.opacity || 0.5;
        var size = options.size || 10;

        var geo = new THREE.BoxGeometry(size,size,size);

        var material = new THREE.MeshLambertMaterial({
//            depthWrite: false,
            transparent: true,
            color: color,
            opacity: opacity,
            side: THREE.BackSide,
            combine: THREE.AdditiveBlending
        });

        return new THREE.Mesh(geo, material );


    }

    function createChild(box){
        child = new Box();

        box.add(child);
    }

    function Floor(){
        var floorMaterial = new THREE.MeshBasicMaterial( { color: 0xf4a460, side: THREE.DoubleSide } );
        var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 10, 10);
        var floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.position.y = -100;
        floor.rotation.x = Math.PI / 2;
        return floor;
    }

    function SkyBox(){
        var skyBoxGeometry = new THREE.CubeGeometry( 10000, 10000, 10000 );
        var skyBoxMaterial = new THREE.MeshBasicMaterial( { color: 0x9999ff, side: THREE.BackSide } );
        var skyBox = new THREE.Mesh( skyBoxGeometry, skyBoxMaterial );
        return skyBox;
    }

    function animate()
    {
        requestAnimationFrame( animate );

//        mesh.rotation.x += 0.01;
//        mesh.rotation.y += 0.02;

//        if(mesh.geometry.boundingBox.containsBox(mesh2.geometry.boundingBox)) {
//            mesh2.translateX(1);
//            mesh2.geometry.boundingBox.setFromObject(mesh2);
//        }

//        console.log(light.position);
//        console.log(camera.position);
//        console.log('-----');

        light.position.set(camera.position.x,camera.position.y,camera.position.z);

        update();
        render();
    }

    function update(time)
    {
        if ( keyboard.pressed("z") )
        {
            // do something
        }

//        new TWEEN.Tween( cube.scale ).to( { y: 10 }, 3000 );

        TWEEN.update(time);
        controls.update();
    }

    function render()
    {
        renderer.render( scene, camera );
    }

</script>

</body>
</html>
